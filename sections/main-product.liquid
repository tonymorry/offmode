{% comment %} Tentativo di recuperare il prodotto dalle impostazioni o dall'handle diretto {% endcomment %}
{%- assign product = section.settings.product -%}
{%- if product == blank -%}
  {%- assign product = all_products['vibepod-mini™'] -%}
{%- endif -%}

{%- assign current_variant = product.selected_or_first_available_variant -%}

<section class="max-w-7xl mx-auto px-4 py-12 md:py-24" data-section-id="{{ section.id }}">
  <div class="grid grid-cols-1 md:grid-cols-2 gap-12 items-center">
    
    <div class="aspect-square bg-[#f5f5f5] rounded-2xl overflow-hidden p-8">
      {% if product.featured_image %}
        <img src="{{ product.featured_image | img_url: '1000x1000' }}" 
             alt="{{ product.title }}"
             class="w-full h-full object-contain mix-blend-multiply">
      {% else %}
        {{ 'product-1' | placeholder_svg_tag: 'w-full h-full' }}
      {% endif %}
    </div>

    <div>
      {% if product != blank %}
        <span class="inline-block px-3 py-1 bg-black text-white text-xs font-medium rounded-full mb-4 uppercase tracking-widest">
          Disponibile Ora
        </span>
        <h2 class="text-3xl md:text-5xl font-serif mb-4">{{ product.title }}</h2>
        <p class="text-2xl text-gray-600 mb-8">{{ product.price | money }}</p>
        
        <div class="prose prose-sm mb-8 text-gray-500">
          {{ product.description }}
        </div>

        {% form 'product', product %}
          <input type="hidden" name="id" value="{{ current_variant.id }}">
          <button type="submit" 
                  class="w-full bg-black text-white py-4 rounded-full hover:bg-gray-800 transition-all transform hover:scale-[1.02] active:scale-[0.98]"
                  {% unless current_variant.available %}disabled{% endunless %}>
            {% if current_variant.available %}
              Aggiungi al Carrello — {{ product.price | money }}
            {% else %}
              Sold Out
            {% endif %}
          </button>
        {% endform %}
      {% else %}
        <div class="p-10 border-2 border-dashed border-gray-200 text-center">
          <p>Configura il prodotto nell'editor del tema o verifica l'handle.</p>
        </div>
      {% endif %}
    </div>
  </div>
</section>

{% schema %}
{
  "name": "Showcase Prodotto",
  "settings": [
    {
      "type": "product",
      "id": "product",
      "label": "Seleziona Prodotto"
    }
  ],
  "presets": [
    {
      "name": "Showcase Prodotto"
    }
  ]
}
{% endschema %}
